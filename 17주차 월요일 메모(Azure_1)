17주차 월요일 메모 Microsoft (Azure)

Microsoft Azure 관리자
과정 AZ-104T00--A: Microsoft Azure Administrator
을 학습한다.
yjji@hotmail.com 지영재 강사. 

Modules for AZ-104T00 (CS) 에서 실습을 한다.
주의할점은 lms.godeploy.it 에서 실습5번까지 가능하며, 그이후는 세션이 불가능.
 
랩에 접속하면 이렇게 화면이 등장함.
 
일반 가상화면에 접속하는것처럼, virtual machines로 로그인하고
웹사이트를 통해 Azure로 로그인한다. 

AWS의 기능과 AZURE은 비슷한 양상이 있다. 매핑이 되는 기능을 파악하도록 하자. 

# 1. Administer Identity _구독을 만들어야 한다(outlook 계정을 만듦)
Describe Microsoft Entra ID Benefits and Features
그러면 테넌트가 만들어진다 (entra ID) 과거는 azure Active Directory
인증은 Kerberos NTLM으로 인증하게된다. 
클라우드는 웹 기반이므로 인증프로토콜이 달라진다.
 
# Entra ID 
SAML과 Oauth(모바일)는 토큰기반으로 되어있음을 유념하자. 
https://portal.azure.com/#home 애저는 이 사이트로 접속하게된다.
 
https://entra.microsoft.com/ 엔트라로 접속하게되면 Identity 이하 다양한것들이 보인다.
 

# Describe Microsoft Entra ID Concepts
1 . 패스워드를 가지고있는 아이디(가장 취약한 방법)
2 . 인증서를 가지고있는 아이디
... 등등 인증할 수 있는 매체들은 모두 아이디이다. 

아이디와 연결된 것은 바로 Account (사용자 계정) 이라고 부른다.
ID 와 Account 는 연결 되어있다.

on-premises에서 No 표시가 되어있으면 sync 된아이디가 아니기때문에 entra ID 에 해당하지않는다.
내가 직접 new account로 만든 아이디가 Entra ID이다.

# 테넌트 란
클라우드서비스를 이용함이라 함은 잠깐 임대인이 되는것이다. (입주자)
On- demand 형식으로 사용한 만큼 지불하게 된다.
특징: 마이크로소프트 클라우드 서비스 구독을 신청할 수 있습니다.
• 추가 인스턴스를 생성할 수 있습니다
• Microsoft Entra ID는 ID 서비스를 제공하는 기본 제품입니다
• 테넌트라는 용어는 단일 조직을 대표하는 단일 인스턴스를 의미합니다
• 테넌트(Tenant)와 디렉토리(Directory)라는 용어는 종종 서로 교환되어 사용됩니다
 
Home> Overview> Manage tenants로 가면, 고유한 테넌트 아이디가 있는것을 알 수 있다.

# 비교하기 (액티브디렉토리와 엔트라ID의 차이)
Compare Microsoft Entra ID to Active Directory Domain Services
1. -Microsoft Entra ID는 주로 ID 솔루션입니다
2. -HTTP 및 HTTPS를 통한 REST API를 사용하여 쿼리됨
3. -SAML, WS-Federation 및 OpenID Connect와 같은 HTTP 및 HTTPS 프로토콜 사용
인증(및 인증을 위한 OAuth)   오픈아이디:권한 / Oauth:인증 으로 분할되어있음.
4. -페더레이션 서비스 및 많은 타사 서비스(예: Facebook) 포함
*페더레이션이란 조직과 조직간 연합을 맺는 것이다. ex)naver SNS연동기술 등 서드파티에 접근 및 접속할 수 있음.
5. -Microsoft EntraID 사용자 및 그룹은 플랫 구조로 생성되며, 없습니다
조직 단위(OU) 또는 그룹 정책 개체(GPOs) 

테넌트 만들기(Entra ID)는 현 실습에서는 불가하다.
 
현재 고객을 위한 평가판 프라이얼 테넌트는 생성할 수 있다. 

새로만든 customer 타입 테넌트로 로그인해본다. 
테넌트는 계층적이 아니라, 독립적( Flat )한 구조를 가지고 있다.
온프레미스는 Domain forest, tree 형 구조를 가진다(계층구조)  

 
테넌트 >라이선스> 모든제품> 라이센스를 확인할 수 있다.
엔트라아이디는 무료기능이나, 추가기능을 사용하기 위해서는 라이센스를 활성화 하고, 각각 사용자마다 라이센스를 부여해야 한다.
 

# Configure Entra ID Device Identities
-Azure AD registered device
• 자신만의 기기를 사용할 수 있도록 지원(다양한 기기 지원)
• 등록된 장치가 다음을 사용하여 로그인합니다 
마이크로소프트 계정
• Azure AD 계정에 첨부됨 
리소스 액세스 권한 부여
• 모바일 장치를 이용한 제어 
다음과 같은 관리(MDM) 도구 
마이크로소프트 ‘인튠’site에서 >>장치관리를 할 수 있다.
• OS – Windows 10+, iOS, Android, 
그리고 MacOS

-Azure AD joined devices (JOIN) 
• 클라우드 우선 또는 클라우드 전용 조직을 대상으로 함 
• 조직 소유 장치
• Azure AD에만 가입 -
필요한 조직 계정
• 조건부 액세스 정책을 사용할 수 있습니다 
• OS – Windows 10+ 장치  // 윈도우즈만 가능하다.

-Hybrid Azure AD joined device (Hybrid JOIN)
일부는 클라우드, 일부는 온프레미스환경인 서비스에 액세스할 때 사용
• Win32 앱이 다음에 배포되어 있습니다 
Active Directory를 사용하는 이러한 장치 
기계 인증
• 그룹을 계속 사용하려고 합니다 
장치 관리 정책
• 기존 이미지를 사용하려고 합니다 
디바이스 배포를 위한 솔루션
• OS - Windows 7+ 장치도 가능.

Implement Self-Service Password Reset> 막혀있다.
1. 셀프 서비스를 사용할 수 있는 사용자 결정
비밀번호 재설정
2. 인증 횟수 선택
필요한 방법과 방법 사용 가능(이메일, 전화, 질문)
3. 사용자에게 등록을 요구할 수 있습니다
SSPR(MFA와 동일한 프로세스)

# Configure User and Group Accounts
사용자와 그룹 계정 만들기.
• 사용자 계정 만들기
• 사용자 계정 관리
• 대량 계정 만들기(옵션)
• 그룹 계정 만들기
• 사용자 및 그룹에 라이센스 할당
(extra주제)
• 관리 단위 만들기(선택사항)
• 데모 – 사용자 및 그룹
• 요약 및 리소스
--
Azure ID 및 거버넌스 관리 (20~25%): Microsoft Entra ID 관리
사용자 및 그룹
• 사용자 및 그룹 만들기
• 사용자 및 그룹 속성 관리
• 외부 사용자 관리
• 라이선스 관리_ 라이센스 할당할때, ‘나라’부분(usage location)은 꼭 채워야 한다.

-사용자 계정
• Azure AD 사용자를 보려면 All users(모든 사용자) 블레이드에 액세스합니다
• Azure AD는 사용자를 세 가지로 정의합니다:
• 클라우드 ID
• 디렉토리 동기화 ID
• 게스트 사용자
Azure AD의 게스트 사용자에 대한 필수 구성 요소
• 디렉토리에 다음과 같이 추가하여 누구든지 조직과 협력하도록 초대할 수 있습니다
객주 이용자.
• 게스트 사용자는 자신의 직장, 학교 또는 사회적 신분으로 로그인할 수 있습니다.
• 게스트 관련 시나리오를 테스트하려면 다음이 필요합니다
• 사용자 계정을 만들 수 있는 역할을 가진 Azure AD 사용자
• 유효한 이메일 계정

# Create Group Accounts
두 가지 다른 유형의 그룹을 정의할 수 있습니다
• 보안 그룹
• 오피스 365(microsoft 365) 그룹
그룹에 구성원 추가:
• 할당됨
• 동적 사용자
• 동적 장치

 
-Architecture diagram
위의 두 테넌트는 각각 az104-01a-aaduser1 , 2를 만들고 그룹에 속하게 만든다.
user1에는 useradministrator 역할을 부여하고
그 다음 az014-01b-aaduser1 게스트유저(할당됨)을 보안그룹인 contoso lab에 초대하는 것이다.
contosolab은 테넌트가 다르다는 점을 유의한다



# Hybrid Identity 
Hybrid Identity with Entra ID
Entra ID Connect를 사용하는 이유는 무엇입니까?
• 사내 애플리케이션 및 클라우드 서비스에 액세스하기 위한 SSO 구현
• 동기화 및 로그인을 위한 구축 환경 간소화
• 시나리오에 맞는 최신 기능 제공

#어떤 인증을 구현할것인가?
엔트리 ID와 하이브리드 ID(1/2)
다음 인증 방법을 사용하여 하이브리드 ID를 구현할 수 있습니다
애저 AD
• 1. PHS(Password Hash Synchronization)
• 2. PTA(Pass Through Authentication)
• 3. 연맹(ADFS)

ID 연결 입력(계속)
-암호 해시 동기화
Entra ID Connect에서 지원
• ADDS에서 사용자 암호 동기화
애저 AD로
• 사용자가 AD 자격 증명을 사용할 수 있도록 허용합니다
액세스 순서:
• 애저 리소스
• 오피스365
• 마이크로소프트 인튠
• 다이나믹스 365
• 애저 ADDS
• 사용자 생산성 향상
• 헬프데스크 비용 절감


# 2. AZ-104T00A Administer Governance and Compliance  
-영역 식별(AZ) 
-Azure 구독 구현
Azure AD 또는 디렉토리에 있는 ID만
Azure AD가 신뢰하는 구독을 생성할 수 있습니다
연결된 Azure 서비스의 논리적 단위
애저계정
보안 및 청구 경계

-구독 사용 현황 파악
무료 - 첫 30일간 $200 크레딧 포함, 무료로 이용할 수 있습니다 (12개월)
매월 - 매월 사용료를 지불합니다
CSP - 마이크로소프트 클라우드 솔루션을 통해 가능한 할인 혜택을 제공하는 CSP 계약
      공급자 파트너 – 일반적으로 중소기업용
Enterprise - One 계약, 신규 라이센스 및 소프트웨어 할인 제공
      보증 – 엔터프라이즈 규모의 조직을 대상으로 함
학생용 - 12개월 동안 $100 포함 학생 – 학생 접근성을 확인해야함.

-서브스크립션 획득(구독 획득하기)
엔터프라이즈 계약 - 고객이 미리 설정한대로,
금전적 약속과 서비스 소비할 수 있다. (일년 내내)
리셀러 - 클라우드 서비스의 간단하고 유연한 구매 방법을 제공합니다 
파트너 -  Azure 클라우드 솔루션을 설계하고 구현할 수 있습니다 
개인 무료 계정 – 바로 시작가능

-리소스 그룹 만들기
리소스는 하나의 리소스 그룹에만 존재할 수 있습니다
그룹에는 다양한 리소스가 있을 수 있습니다
여러 지역에서 온 유형(services)과
그룹의 이름을 바꾸거나 중첩할 수 없습니다
그룹 간에 리소스를 이동할 수 있습니다

-서비스 제한 및 할당량 결정
*리소스에 기본 제한이 있습니다 - 청약 정원
*현재 사용량을 추적하고 향후 사용 계획을 짜는데 도움이 됩니다
*무료 지원을 열 수 있습니다 - 공표된 최대치 에 대한 제한을 늘리는 경우

-애저 리소스 계층 생성
관리 그룹은 구독 이상의 범위 수준을 제공합니다
  계층적 계층 아래에서 구독 및 상속 전반에 걸쳐 정책 목표 및 예산 지출
  조직(사업/팀)별 컴플라이언스 및 비용 보고 구현

-리소스 태그 적용
Azure 리소스에 대한 메타데이터 제공
 리소스를 논리적으로 구성합니다
 이름-값 쌍으로 구성됩니다
 청구 정보를 롤업하는 데 매우 유용합니다

-비용 관리
비용은 리소스별로 다릅니다
사용 비용은 위치에 따라 다를 수 있습니다
인바운드 및 아웃바운드 데이터 전송 비용이 다름
Azure 예약된 인스턴스로 사전 결제
Azure 하이브리드 혜택과 함께 사내 라이센스 사용
경고, 예산 및 권장 사항을 통해 최적화

# Configure Azure Policy
-Azure 정책 구현
정책을 생성, 할당 및 관리하는 서비스
비준수 리소스에 대한 평가 및 검색 실행
장점:
• 집행 및 규정 준수
• 규모에 따라 정책 적용
• 교정조치

사용 사례
허용되는 리소스 유형 – 조직에서 배포할 수 있는 리소스 유형 지정
허용되는 가상 시스템 SKU – 조직에서 배포할 수 있는 가상 시스템 SKU 집합 지정
허용된 위치 – 리소스를 배포할 때 조직에서 지정할 수 있는 위치 제한
Required 태그 및 값 – Required 태그 및 값 적용
가상 시스템에 대해 Azure Backup을 사용하도록 설정해야 함 – 모든 가상 시스템에 대해 Azure Backup 서비스를 사용하도록 설정한 경우 감사

-Azure 정책 만들기
정의 및 작성
범위 및 할당
컴플라이언스 평가

-데모 – Azure 정책
• 정책 정의 생성
• 이니셔티브 정의 작성 및 범위 지정
• 규정 준수 여부 결정
-요약 및 리소스

1. 정책 정의 생성
많은 정책 정의를 사용할 수 있습니다
GitHub에서 정책을 가져올 수 있습니다
정책 정의에 특정 JSON 형식이 있습니다
사용자 지정 정책 정의를 생성할 수 있습니다

2. 이니셔티브 정의 작성
그룹 정책 정의
하나 이상의 정책 포함
계획이 필요합니다

3. 이니셔티브 정의의 범위 지정
범위에 정의 할당 – 범위가 정책을 적용합니다
관리 그룹, 구독 및 선택적으로 리소스 그룹 선택

4. 규정 준수 여부 결정
규정을 준수하지 않는 이니셔티브, 정책 및 리소스
한 시간에 한 번 정도 평가 및 보고
자동 치료*복구가 가능합니다

-리소스 관리자 이점 검토
일관된 관리 계층 제공
솔루션의 리소스를 그룹으로 사용하여 작업할 수 있도록 지원합니다
단일 조정 작업으로 배포, 업데이트 또는 삭제
보안, 감사 및 태그 지정 기능 제공
사용자에게 가장 적합한 툴 및 API 선택

Azure 리소스 용어 검토(Resource Terminology)
리소스는 Azure의 단일 서비스 인스턴스에 불과합니다
리소스 그룹은 리소스의 논리적 그룹입니다
Azure Resource Manager 템플릿은 리소스 집합을 선언적으로 설명할 수 있는 JSON 파일입니다
선언 구문은 템플릿이 작성하려는 내용을 진술하는 데 사용되는 구문입니다
리소스 공급자는 리소스 관리자를 통해 배포 및 관리할 수 있는 리소스를 제공하는 서비스입니다

리소스 관리자 잠금 생성
잠금을 구독, 리소스 그룹 또는 리소스와 연결
잠금은 하위 리소스에 의해 상속됩니다
읽기 전용 잠금을 사용하면 리소스 변경을 방지할 수 있습니다
잠금 삭제로 인해 삭제할 수 없습니다

Lab 02 A. Manage Subscriptions and RBAC Entra부분 (lms.godeploy.it 사이트)
 
 
 

# Configure Role-Based Access Control _목차
Azure RBAC 역할과 Azure AD 역할 비교
역할 정의 만들기
역할 할당 만들기
RBAC 인증 적용
시연 – Azure RBAC
요약 및 리소스

Azure RBAC 역할과 Azure AD 역할 비교
RBAC 역할을 통해 세분화된 액세스 관리 제공
# 애저 RBAC 역할
Azure 리소스에 대한 액세스 관리
범위를 여러 수준에서 지정할 수 있습니다
역할 정보는 Azure 포털, Azure CLI, Azure PowerShell, Azure Resource Manager 템플릿, REST API에서 액세스할 수 있습니다

# 애저 AD 역할
Azure AD 개체에 대한 액세스 관리
범위가 테넌트 수준입니다
역할 정보는 Azure 포털, Microsoft 365 관리 포털, Microsoft Graph, Azure Active Directory PowerShell for Graph에서 액세스할 수 있습니다

>라이브랩02 실습
홈>리소스 그룹> ‘내 리소스’ > IAM항목으로 이동 >ADD (add role assignment)
Role들이 존재함.
role: virtualmachine contributor 선택
권한을 Members에서 select > 해당ID에 권한부여
scope (범위)가 특정됨.
>검토 및 assign을 누르면 실행됨
>>Role assignment로 가면 확인이 가능하다.



