17주차 금요일 메모 Microsoft(Azure5)

랩8과 9
# AZ-104T00A Azure 관리 가상 머신
가상 머신 구성

클라우드 서비스 책임 검토
데모 - 포털에서 VM 만들기
가상 가상 머신에 연결
가상 머신 스토리지 결정
Linux 가상 머신에 연결
가상 머신 크기 결정
데모 ‒ Linux VM에 연결(선택 사항)
Windows 가상 머신에 연결
가상 머신 계획

$ 가상 머신 크기 결정
범용 - 균형 잡힌 CPU 대 메모리 비율.
컴퓨팅 최적화 - CPU 대 메모리 비율이 높습니다.
최적화된 스토리지 - 높은 디스크 처리량 및 I/O.
GPU - 과도한 그래픽 렌더링 및 비디오 편집을 목표로 하는 특수 가상 머신입
높은 메모리 대 CPU 비율.
고성능 컴퓨팅(HPC) - 가장 빠르고 강력한 CPU 가상 머신

$ 가상 머신 스토리지 결정
각 Azure VM에는 두 개 이상의 디스크가 있습니다.
• OS 디스크 
• 임시 디스크(모든 SKU에 하나가 있는 것은 아니며 콘텐츠가 손실될 수 있음)
• 데이터 디스크(선택 사항) 
OS 및 데이터 디스크는 Azure Storage 계정에 있습니다. 
• Azure 기반 스토리지 서비스 
• 표준(HDD, SSD), 프리미엄(SSD) 또는 Ultra(SSD) 
Azure VM은 관리 디스크를 사용합니다.

$ 관리 디스크
Azure Managed Disks는 Azure Storage의 현재 표준 및 프리미엄 스토리지 디스크를 추상화한 것. 
• ARM 리소스로서의 디스크 
• 디스크에 대한 스토리지 계정 없음 
• 디스크에 대한 계정 규모 제한 없음

관리 디스크의 장점
• 간단한 관리 및 보안 
• Azure에서 관리되는 디스크, 직접적인 공개 액세스 없음 
• 논리적 최상위 리소스인 디스크. 디스크 수준 RBAC 
• 확장 
• 스토리지 계정 제한 없이 확장 가능 
• VMSS(VM 확장 집합) 지원 
• 고가용성
• VM 가용성 세트의 스토리지 격리 
• VMFD는 관리 디스크 FD와 일치

$ 향상된 가용성
1. VM FD는 관리 디스크 FD와 일치합니다.
2. 스토리지 계정은 다른 가용성 집합과 공유되지 않습니다.
3. 구독당 지역당 50,000 ‒ 75,000

# 데모 ‒ 포털에서 VM 만들기
-Windows 가상 머신에 연결
원격 데스크톱 프로토콜 (RDP)는 GUI 세션을 생성하고 TCP 포트 3389에서 인바운드 트래픽을 허용합니다.
WinRM은 스크립트를 실행할 수 있도록 명령줄 세션을 만듭니다.

- Linux 가상 머신에 연결
SSH 공개 키 또는 비밀번호로 인증
SSH는 보안되지 않은 연결을 통해 보안 로그인을 허용하는 암호화된 연결 프로토콜입니다.
공개키와 개인키가 있습니다

- 가상 머신에 연결
SSL을 통한 포털을 통한 RDP/SSH용 Bastion 서브넷 
원격 데스크톱 프로토콜 Windows 기반 가상 머신
Linux 기반 가상 머신 용 Secure Shell 프로토콜

- Azure Bastion(1/2)
주요 기능: 
• Azure Portal에서 직접 RDP 및 SSH 
• RDP/SSH를 위한 TLS 및 방화벽 통과를 통한 원격 세션 
• Azure VM에는 공용 IP가 필요하지 않습니다 . 
• NSG 를 관리하는 번거로움이 없습니다 .
• 포트 스캐닝으로부터 보호합니다. 
• 제로데이 익스 플로잇으로부터 보호합니다

Azure Bastion(2/2)
인스턴스 및 호스트 확장:
• 인스턴스는 Azure Bastion을 구성할 때 생성되는 최적화된 Azure VM입니다. Azure에서 완전히 관리됩니다.
• 기본 SKU, 두 개의 인스턴스가 생성됩니다.
• 표준 SKU의 경우 인스턴스 수를 지정할 수 있습니다. 
• 각 인스턴스는 25개의 동시 RDP 연결과 50개의 동시 SSH를 지원할 수 있습니다.
• 인스턴스는 AzureBastionSubnet에 생성됩니다.
• 기본적으로 연결에 사용되는 인바운드 포트는 RDP의 경우 3389이고 SSH의 경우 22입니다.
Azure Bastion ‒ SKU 업그레이드
• Bastion을 삭제하고 재구성하지 않으면 기본 SKU로 되돌릴 수 없습니다. 
• Azure Portal에서만 구성할 수 있습니다.
 

#가상 머신 가용성 구성
유지 관리 및 가동 중지 시간 계획
1. 계획되지 않은 하드웨어유지
플랫폼이 오류를 예측하면 계획되지 않은 하드웨어 유지 관 리 이벤트가 발생합니다.
작업: 실시간 마이그레이션
2. 예기치 않은 중단시간
예상치못한 다운타임_ 가상머신이 예기치않게 실패한 경우이다. 
조치: 자동으로 마이그레이션(자가복구)
3. 예정 유지
계획된 유지 관리 이벤트는 정기적인 업데이트입니다.
조치: 조치 없음

-가용성 집합 설정
가용성 집합의 두 개 이상 의 인스턴스 = 99.95% SLA 
365일 중 약 4.38시간 동안 시스템이 사용 불가능할 수 있습니다.
다운타임 = (100% - 99.95%) × 총 시간
여러 구성 가용성 집합의 가상머신을 둡니다.
각 애플리케이션 계층구성, 별도로 가용성을 세팅
하중 결합적 밸런서 가용성 세팅
가상머신과 함께 관리디스크를 사용.

-업데이트 및 오류 도메인 검토
업데이트 도메인을 사용 하면 Azure 가 배포 전체에서 증분 또는 롤링 업그레이드를 수행할 수 있습니다. 계획된 유지 관리 기간 동안 한번에 하나의 업데이트 도메인만 재부팅됩니다

오류 도메인은 단일 실패 지점을 공유하는 공통 하드웨어 세트, 스위치를 공유하는 가상머신 그룹입니다 . 가용성 집합의 VM은 두 개 이상 의 장애 도메인에 배치됩니다.

- 가용성 영역 검토
지역 내 고유한 물리적 위치
독립적인 전원, 냉각 및 네트워킹을 갖춘 데이터 센터를 포함합니다 (총 셋)
데이터센터 장애로부터 보호
업데이트 및 장애 도메인 결합
99.99% SLA 제공 = 0.876시간동안 시스템 사용불가

-수직 스케일링과 수평 스케일링 비교
수직적 확장 (확장 및 축소) =은 워크 로드 의 단일 인스턴스에 대한 전력을 늘리거나 줄이는 프로세스 입니다. 일반적으로 수동입니다.
수평적 확장 (수평 확장_scale in) =은 인스턴스 수를 늘리거나 줄이는 프로세스입니다. 
작업량; 자주 자동화됨 
 

$ 확장 집합 만들기
인스턴스 수. 확장 집합의 VM 수(0~1000)
인스턴스 크기. 확장 집합에 있는 각 가상머신의 크기
Azure 스팟 인스턴스. 할인된 가격으로 미사용 용량
관리 디스크 사용
100 개 이상의 인스턴스 확장 지원

-자동 크기 조정 구성
VM 인스턴스 의 최소, 최대 및 기본 수 정 의
확장 및 확장을 통해 고급 확장 집합 만들기
매개변수 축소

# 가상 머신 확장 구성
가상 머신 확장 구현
확장은 배포 후 VM 구성 및 자동화 작업을 제공하는 작은 애플리케이션이다.
Azure CLI, PowerShell, Azure로 관리됨 
새로운 VM 배포와 함께 번들로 제공되거나 기존 시스템에 대해 실행됩니다. 
Resource Manager 템플릿 및 Azure Portal
Windows 및 Linux 시스템마다 다릅니다.

-사용자 정의 스크립트 확장 구현
확장 스크립트는 간단할 수도 있고 복잡할수도 있습니다.
확장 프로그램 실행 시간은 90분입니다.
가용성을 보장하기 위해 종속성을 다시 확인
발생할 수 있는 오류를 고려하세요.
민감한 정보 보호/암호화

# 실습 08 ‒ 가상 머신 관리
랩 시나리오
Azure Virtual Machines를 배포하고 구성하기 위한 다양한 옵션을 식별해야 합니다.
작업> 1: 영역 복원력이 있는 가상 배포 Azure Portal 및 템플릿이 있는 머신 / 2. Azure 가상 구성가상 머신 확장을 사용하는 머신 / 3. Azure Virtual Machines를 위한 컴 퓨팅 및 스토리지 확장
/ 4. Azure Portal을 사용하여 영역 복원 력이 있는 확장 집합 배포 / 5. Azure 가상 머신 확장 집합을 구성합니다. / 6. Azure 가상 머신 확장 집합에 대한 컴 퓨팅 및 스토리지 크기 조정
 


# AZ-104T00A  PaaS 관리  컴퓨팅 옵션
- Azure App Service 계획 구성
Azure App Service 계획 구현
실행할 웹앱에 대한 컴퓨팅 리소스 집합 정의
성능, 가격, 기능을 결정합니다.
동일한 App Service 계획에서 실행되도록 하나 이상의 앱을 구성할 수 있습니다.
컴퓨팅 리소스가 생성될 지역: 가상 머신 인스턴스 수/ 가상 머신 인스턴스의 크기/ 가격 책정 계층

-App Service 계획 확장 및 확장
강화(App Service 계획 변경): 추가 하드웨어(CPU, 메모리, 디스크) / 추가 기능(전용 가상 머신, 스테이징 슬롯, 자동 크기 조정)
수평 확장(VM 인스턴스 수 증가): 수동(고정된 인스턴스 수) / 자동 크기 조정(사전 정의된 규칙 및 일정 기반)

- App Service 계획 크기 조정 구성
현재 수요 에 따라 사용 가능한 리소스를 조 정합니다.
가용성 및 내결함성 향상
다음을 기준으로 확장 측정항목(CPU 비율, 메모리 비율, HTTP 요청)
일정에 따른 확장 (주중, 주말, 시간대, 공휴일)
지표 와 일정 결합의 구현
규모를 축소하는 것을 잊지 않기.

# Azure 앱 서비스 구성
Azure 앱 서비스 구현
 
웹 앱, API 앱, 모바일 앱 및 기능 앱 포함
높은 생산성 개발을 가능하게 하는 완전 관리형 환경
플랫폼이 인프라를 처리하므로 개발자는 핵심 웹 앱 및 서비스에 집중할 수 있습니다.
웹 및 모바일용 고가용성 클라우드 앱 구축 및 배포를 위한 PaaS(Platform-as-a-Service) 제품
.NET, .NET Core, Java, Python 및 기타 여러 가지를 사용한 개발자 생산성
엔터프라이즈급 보안 및 규정 준수 제공

- 앱 서비스 만들기
이름은 고유해야 합니다.
azurewebsites.net을 사용한 액세스 ‒ 사용자 지정 도메인에 매핑 가능
코드 게시(런타임 스택)
Docker 컨테이너 게시
리눅스 또는 윈도우
사용자와 가장 가까운 지역
앱 서비스 계획

- 배포 슬롯 생성
스테이지 슬롯을 사용한 지속적인 배포(GitHub를 이용한 방법)
다른 배포 슬롯에 배포 (서비스 계획에 따라 다름)
프로덕션으로 보내기 전에 변경 사항을 검증
배포 슬롯은 자체 호스트 이름이 있는 라이브 앱
콜드 스타트 방지 ‒ 가동 중지 시간 제거
마지막으로 알려진 양호한 사이트 로 대체
스왑 전 검증이 필요하지 않은 경우 자동 스왑

-배포 슬롯 추가
다른 배포 슬롯에서 앱 구성을 복제할지 여부를 선택하기
복제할 때 설정에 주의하세요.
• 슬롯별 앱 설정 및 연결 문자열 • 지속적 배포 설정 • App Service 인증 설정
모든 설정이 고정되는 것은 아닙니다(엔드포인트, 사용 자 정의 도메인 이름, SSL 인증서, 확장).
교체하기 전에 설정을 검토하고 편집하세요.

-앱 서비스 보안
인증방법 :
 • 인증 활성화 ‒ 기본값은 익명 • 타사 ID 공급자로 로그인
보안: 
• 진단 로그 문제 해결 ‒ 실패한 요청, 앱 로깅
• SSL 인증서 추가 ‒ HTTPS
• 우선 순위가 지정된 허용/거부 목록을 정의하여 앱에 대한 네트워크 액세스를 제어합니다. 
• Azure Key Vault에 비밀을 저장합니다.

-사용자 정의 도메인 이름 만들기
기본 웹 앱 URL 리디렉션
Azure에서 사용자 지정 도메인 유효성 검사
도메인 공급자의 DNS 레지스트리를 사용. 매핑이 포함된 CNAME 또는 A레코드 를 만듦
App Service 계획이 사용자지정 도메인을 지원하는지 확인

-앱 서비스 백업
수동으로 또는 일정에 따라 앱 백업 만들기
앱에 연결된 구성, 파일 콘텐츠, 데이터베이스를 백업
표준 또는 프리미엄 플랜 필요
앱과 데이터베이스는 최대 10GB까지 백업할 수 있습니다.
부분 백업 구성 및 백업 에서 항목 제외
주문형 앱을 이전 상태로 복원합니다.( 새앱을 만들 수도 있음 )

# Azure 컨테이너 인스턴스 구성
Azure Container Instances 이점 살펴보기
• PaaS 서비스 • 빠른 시작 시간 • 공용 IP 연결 및 DNS 이름 • 맞춤 크기 • 공동 예약된 그룹 • 가상 네트워크 배포 • 격리 기능 • Linux 및 Windows 컨테이너

- 컨테이너 그룹 구현
다음의 최상위 리소스 Azure 컨테이너 인스턴스
컨테이너 컬렉션 그 날짜에 예정된 같은 호스트
그룹의 컨테이너는 수명주기, 리소스, 로컬 네트 워크 및 스토리지 볼륨을 공유합니다.

- Docker 플랫폼 이해
개발자가 컨테이너 내에서 애플리케이션을 호스팅 할 수 있습니다.
컨테이너는 애플리케이션을 실행하는 데 필요한 모든 것을 포함하는 표준화된 "소프트웨어 단위" 입니다
Linux 와 Windows 모두에서 사용 가능하며 Azure에서 호스팅 가능

- Azure Kubernetes 서비스 구성
AKS 용어 이해
POOL = 동일한 구성을 가진 노드그룹
Node = 컨테이너화된 애플리케이션을 실행하는 개별 VM
Pod = 애플리케이션의 단일 인스턴스이다. 팟에는 여러 컨테이너가 포함될 수 있음.
배포(Deployment) = 쿠버네티스에서 관리하는 하나이상의 동일한 팟
declair (선언_Yaml파일) = 배포를 설명하는 야믈 파일.
 

- AKS 클러스터 및 노드 이해
Azure 관리 노드는 핵심 Kubernetes 서비스 및 오케 스트레이션을 제공합니다.
고객 관리 노드는 애플리케이션 및 지 원 서비스를 실행합니다.
각 개별 노드는 Azure 가상 머신
 

-AKS 네트워킹 구성
포드는 애플리 케이션의 인스턴스를 실행합니다.
네트워크 연결을 제공하기 위해 서비스 그룹 포드가 담당한다.
ClusterIP는 내부 입장 트래픽을 제공합니다.
노드포트 들어오는 직접 트래픽 에 대한 매핑 제공
LoadBalancer에는 들어오는 간접 트래픽을 위한 외부 IP 주소가 있습니다
 

-AKS 저장소 구성
노드의 로컬 스토리지는 빠르고 사용이 간편합니다.
포드가 삭제된 후 로컬 스토리지를 사용하지 못할 수 있음
여러 포드가 데이터 볼륨을 공유할 수 있음
스토리지가 잠재적으로 다른 포드에 다시 연결될 수 있음
 

-AKS 크기 조정 구성
애플리케이션이 단일 포드의 용량을 초과하여 성장할 수 있음
Kubernetes에는 자동 크기 조정기가 내장되어 있습니다.
클러스터 자동 확장 처리는 컴퓨팅 리소스를 기반으로 확장됩니다.
측정항목을 기반으로 수평형 Pod 자동 확장 처리 확장

# 실습 09a ‒ 웹 앱 구현
랩 시나리오
현재 회사의 온-프레미스 데이터 센터에서 호스팅되는 Contoso의 웹 사이트를 호스팅하기 위해 Azure 웹앱의 사용을 평가해야 합니다. 웹 사이트는 PHP 런타임 스택을 사용하여 Windows 서버에서 실행됩니다. 또한 Azure 웹앱 배포 슬롯을 활용하여 DevOps 방식을 구현하는 방법을 결정해야 합니다.
작업> Azure 웹앱 만들기 / 스테이징 만들기 배포 슬롯 / 웹앱 배포 설정 구성 / 스테이징 배포 슬롯에 코드 배포 / 준비 슬롯 바꾸기 / Azure 웹앱의 자동 크기 조정 구성 및 테스트
 
 

# 랩 09b ‒ Azure Container Instance 구현
랩 시나리오
Contoso는 가상화된 워크로드를 위한 새로운 플랫폼을 찾고 싶어합니다. 이 목표를 달성하는 데 활용할 수 있는 여러 컨테이너 이미지를 식별했습니다. 컨테이너 관리를 최소화하려고 하므로 Docker 이미지 배포를 위해 Azure Container Instances 사용을 평가할 계획입니다.
작업> Azure를 사용하여 Docker 이미지 배포 컨테이너 인스턴스 / Azure의 기능 검토 컨테이너 인스턴스
 

# 랩 09c ‒ Azure Kubernetes 서비스 구현(선택 사항)
랩 시나리오
Contoso에는 Azure Container Instances를 사용하여 실행하기에 적합하지 않은 여러 다중 계층 애플리케이션이 있습니다. 컨테이너화된 워크로드로 실행할 수 있는지 확인하려면 Kubernetes를 컨테이너 오케스트레이터로 사용하여 평가하려고 합니다. 관리 오버헤드를 최소화하기 위해 단순화된 배포 환경 및 크기 조정을 포함하여 Azure Kubernetes Service를 테스트하려고 합니다.
작업 > Azure Kubernetes 배포 서비스 클러스터/ Azure에 포드 배포 Kubernetes 서비스 클러스터
/ 컨테이너화된 규모 Azure의 워크로드 Kubernetes 서비스 클러스터
 


